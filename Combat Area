-- Combat Arena Script dengan UI Rayfield - COMPLETE VERSION
-- Battle Area | (WaveTerminal) | Version 1.0

local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Rayfield/main/source'))()

local Window = Rayfield:CreateWindow({
    Name = "Battle Area | (WaveTerminal)",
    LoadingTitle = "Battle Area v1.0",
    LoadingSubtitle = "Combat Arena Script by WaveTerminal",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "BattleArea",
        FileName = "Configuration"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "Battle Area",
        Subtitle = "Enter Key",
        Note = "Join discord.gg/ for key",
        FileName = "BattleKey",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {"WaveTerminal123"}
    }
})

-- Variables
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- Aimbot Variables
local aimbotEnabled = false
local triggerbotEnabled = false
local teamCheck = true
local wallCheck = true
local fovCircleEnabled = true
local fovRadius = 150
local smoothness = 0.15
local aimPart = "Head"
local holdToAim = false
local aimKey = Enum.UserInputType.MouseButton2

-- FOV Circle
local fovCircle
local circleColor = Color3.fromRGB(255, 255, 255)
local circleTransparency = 0.5

-- ESP Variables
local espEnabled = false
local boxes = {}
local RainbowName = false
local RainbowHealth = false
local RainbowBox = false

-- Movement Variables
local walkspeedEnabled = false
local jumppowerEnabled = false
local infJumpEnabled = false
local noclipEnabled = false
local defaultWalkspeed = 16
local defaultJumppower = 50
local currentWalkspeed = 50
local currentJumppower = 75
local noclipConnection = nil
local flyEnabled = false
local flySpeed = 50
local flyConnection = nil

-- Tools Variables
local fullbrightEnabled = false
local nofogEnabled = false
local boostfpsEnabled = false
local originalFogStart = 0
local originalFogEnd = 0

-- Connections
local aimbotConnection
local triggerbotConnection
local renderConnection
local espConnection
local infJumpConnection

-----------------------------------------------------------
--                     MOVEMENT FUNCTIONS
-----------------------------------------------------------

local function applyWalkspeed()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        char.Humanoid.WalkSpeed = walkspeedEnabled and currentWalkspeed or defaultWalkspeed
    end
end

local function applyJumppower()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        char.Humanoid.JumpPower = jumppowerEnabled and currentJumppower or defaultJumppower
    end
end

local function toggleInfJump(state)
    infJumpEnabled = state
    
    if infJumpConnection then
        infJumpConnection:Disconnect()
        infJumpConnection = nil
    end
    
    if state then
        infJumpConnection = UserInputService.JumpRequest:Connect(function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid:ChangeState("Jumping")
            end
        end)
    end
end

local function toggleNoclip(state)
    noclipEnabled = state
    
    if noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
    end
    
    if state then
        noclipConnection = RunService.Stepped:Connect(function()
            if noclipEnabled and LocalPlayer.Character then
                for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        if LocalPlayer.Character then
            for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
end

local function toggleFly(state)
    flyEnabled = state
    
    if flyConnection then
        flyConnection:Disconnect()
        flyConnection = nil
    end
    
    if state then
        flyConnection = RunService.Heartbeat:Connect(function()
            if flyEnabled and LocalPlayer.Character then
                local char = LocalPlayer.Character
                local root = char:FindFirstChild("HumanoidRootPart")
                local humanoid = char:FindFirstChild("Humanoid")
                
                if root and humanoid then
                    humanoid.PlatformStand = true
                    
                    local velocity = Vector3.new(0, 0, 0)
                    
                    if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                        velocity = velocity + Camera.CFrame.LookVector * flySpeed
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                        velocity = velocity - Camera.CFrame.LookVector * flySpeed
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                        velocity = velocity - Camera.CFrame.RightVector * flySpeed
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                        velocity = velocity + Camera.CFrame.RightVector * flySpeed
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                        velocity = velocity + Vector3.new(0, flySpeed, 0)
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
                        velocity = velocity - Vector3.new(0, flySpeed, 0)
                    end
                    
                    root.Velocity = velocity
                end
            end
        end)
    else
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.PlatformStand = false
        end
    end
end

-----------------------------------------------------------
--                     TOOLS FUNCTIONS
-----------------------------------------------------------

local function toggleFullbright(state)
    fullbrightEnabled = state
    
    if state then
        Lighting.GlobalShadows = false
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
        
        for _, light in pairs(Lighting:GetChildren()) do
            if light:IsA("Light") then
                light.Enabled = false
            end
        end
    else
        Lighting.GlobalShadows = true
        Lighting.Brightness = 1
        Lighting.ClockTime = 14
        Lighting.OutdoorAmbient = Color3.new(0.5, 0.5, 0.5)
        
        for _, light in pairs(Lighting:GetChildren()) do
            if light:IsA("Light") then
                light.Enabled = true
            end
        end
    end
end

local function toggleNofog(state)
    nofogEnabled = state
    
    if state then
        originalFogStart = Lighting.FogStart
        originalFogEnd = Lighting.FogEnd
        
        Lighting.FogStart = 100000
        Lighting.FogEnd = 100000
        Lighting.FogColor = Color3.new(1, 1, 1)
    else
        Lighting.FogStart = originalFogStart
        Lighting.FogEnd = originalFogEnd
    end
end

local function toggleBoostFPS(state)
    boostfpsEnabled = state
    
    if state then
        -- Settings like Infinite Yield
        settings().Rendering.QualityLevel = 1
        settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Level04
        settings().Rendering.EagerBulkExecution = true
        
        local decalsyeeted = true
        local g = game
        local w = g.Workspace
        local l = g.Lighting
        local t = w.Terrain
        
        t.WaterWaveSize = 0
        t.WaterWaveSpeed = 0
        t.WaterReflectance = 0
        t.WaterTransparency = 0
        
        l.GlobalShadows = false
        l.FogEnd = 9e9
        l.Brightness = 2
        
        sethiddenproperty(l, "Technology", 2)
        sethiddenproperty(t, "Decoration", false)
        
        for i, v in pairs(w:GetDescendants()) do
            if v:IsA("BasePart") and not v:IsA("MeshPart") then
                v.Material = Enum.Material.Plastic
                v.Reflectance = 0
            elseif (v:IsA("Decal") or v:IsA("Texture")) and decalsyeeted then
                v.Transparency = 1
            elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
                v.Lifetime = NumberRange.new(0)
            elseif v:IsA("Explosion") then
                v.BlastPressure = 1
                v.BlastRadius = 1
            elseif v:IsA("Fire") or v:IsA("SpotLight") or v:IsA("Smoke") then
                v.Enabled = false
            elseif v:IsA("MeshPart") then
                v.Material = Enum.Material.Plastic
                v.Reflectance = 0
            end
        end
        
        for i, e in pairs(l:GetChildren()) do
            if e:IsA("BlurEffect") or e:IsA("SunRaysEffect") or e:IsA("ColorCorrectionEffect") or e:IsA("BloomEffect") or e:IsA("DepthOfFieldEffect") then
                e.Enabled = false
            end
        end
    else
        -- Reset to default
        settings().Rendering.QualityLevel = 10
        settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Level20
        settings().Rendering.EagerBulkExecution = false
        
        Lighting.GlobalShadows = true
        Lighting.Brightness = 1
        Lighting.FogEnd = originalFogEnd
    end
end

local function serverHop()
    local PlaceID = game.PlaceId
    local AllIDs = {}
    local foundAnything = ""
    local actualHour = os.date("!*t").hour
    local Deleted = false
    
    local function TPReturner()
        local Site
        if foundAnything == "" then
            Site = game.HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. PlaceID .. '/servers/Public?sortOrder=Asc&limit=100'))
        else
            Site = game.HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. PlaceID .. '/servers/Public?sortOrder=Asc&limit=100&cursor=' .. foundAnything))
        end
        
        local ID = ""
        if Site.nextPageCursor and Site.nextPageCursor ~= "null" and Site.nextPageCursor ~= nil then
            foundAnything = Site.nextPageCursor
        end
        
        for i,v in pairs(Site.data) do
            local Possible = true
            ID = tostring(v.id)
            if tonumber(v.maxPlayers) > tonumber(v.playing) then
                for _,Existing in pairs(AllIDs) do
                    if num ~= 0 then
                        if ID == tostring(Existing) then
                            Possible = false
                        end
                    else
                        if tonumber(actualHour) ~= tonumber(Existing) then
                            local delFile = pcall(function()
                                AllIDs = {}
                                table.insert(AllIDs, actualHour)
                            end)
                        end
                    end
                end
                
                if Possible == true then
                    table.insert(AllIDs, ID)
                    wait()
                    pcall(function()
                        wait()
                        TeleportService:TeleportToPlaceInstance(PlaceID, ID, LocalPlayer)
                    end)
                    wait(4)
                end
            end
        end
    end
    
    while wait() do
        pcall(function()
            TPReturner()
            if foundAnything ~= "" then
                TPReturner()
            end
        end)
    end
end

-----------------------------------------------------------
--                     ESP FUNCTIONS
-----------------------------------------------------------

local function getRainbowColor(speed)
    local time = tick() * speed
    local r = (math.sin(time) + 1) / 2
    local g = (math.sin(time + 2) + 1) / 2
    local b = (math.sin(time + 4) + 1) / 2
    return Color3.new(r, g, b)
end

local function healthColor(health, maxHealth)
    local ratio = math.clamp(health / maxHealth, 0, 1)
    return Color3.fromRGB(255 * (1 - ratio), 255 * ratio, 0)
end

local function createBox()
    local box = Drawing.new("Square")
    box.Thickness = 2
    box.Transparency = 1
    box.Filled = false

    local name = Drawing.new("Text")
    name.Size = 14
    name.Center = true
    name.Outline = true

    local healthText = Drawing.new("Text")
    healthText.Size = 14
    healthText.Center = true
    healthText.Outline = true

    local distanceText = Drawing.new("Text")
    distanceText.Size = 12
    distanceText.Center = true
    distanceText.Outline = true
    distanceText.Color = Color3.fromRGB(200, 200, 200)

    return {
        box = box,
        name = name,
        healthText = healthText,
        distanceText = distanceText,
        blink = false,
        blinkTimer = 0
    }
end

local function removeBox(boxTable)
    if boxTable then
        if boxTable.box then boxTable.box:Remove() end
        if boxTable.name then boxTable.name:Remove() end
        if boxTable.healthText then boxTable.healthText:Remove() end
        if boxTable.distanceText then boxTable.distanceText:Remove() end
    end
end

local function updateBox(boxTable, character, deltaTime)
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoid or humanoid.Health <= 0 or not rootPart then
        boxTable.box.Visible = false
        boxTable.name.Visible = false
        boxTable.healthText.Visible = false
        boxTable.distanceText.Visible = false
        return false
    end

    local pos, visible = Camera:WorldToViewportPoint(rootPart.Position)
    if not visible then
        boxTable.box.Visible = false
        boxTable.name.Visible = false
        boxTable.healthText.Visible = false
        boxTable.distanceText.Visible = false
        return true
    end

    local topPos, _ = Camera:WorldToViewportPoint(rootPart.Position + Vector3.new(0, 3, 0))
    local bottomPos, _ = Camera:WorldToViewportPoint(rootPart.Position - Vector3.new(0, 3, 0))

    local height = math.abs(topPos.Y - bottomPos.Y)
    local width = height / 2

    boxTable.box.Size = Vector2.new(width, height)
    boxTable.box.Position = Vector2.new(pos.X - width / 2, pos.Y - height / 2)

    local healthRatio = humanoid.Health / humanoid.MaxHealth
    local baseColor = healthColor(humanoid.Health, humanoid.MaxHealth)
    local color = baseColor

    if RainbowBox then
        color = getRainbowColor(3)
    end

    if healthRatio < 0.2 then
        boxTable.blinkTimer = boxTable.blinkTimer + deltaTime
        if boxTable.blinkTimer > 0.5 then
            boxTable.blink = not boxTable.blink
            boxTable.blinkTimer = 0
        end
        boxTable.box.Color = boxTable.blink and Color3.new(1,0,0) or color
    else
        boxTable.box.Color = color
        boxTable.blink = false
        boxTable.blinkTimer = 0
    end
    boxTable.box.Visible = true

    boxTable.name.Position = Vector2.new(pos.X, pos.Y - height / 2 - 18)
    boxTable.name.Text = character.Name
    boxTable.name.Color = RainbowName and getRainbowColor(5) or Color3.fromRGB(255, 255, 255)
    boxTable.name.Visible = true

    boxTable.healthText.Position = Vector2.new(pos.X, pos.Y + height / 2 + 2)
    boxTable.healthText.Text = ("HP: %d"):format(math.floor(humanoid.Health))
    boxTable.healthText.Color = RainbowHealth and getRainbowColor(4) or baseColor
    boxTable.healthText.Visible = true

    local dist = (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) and
        (LocalPlayer.Character.HumanoidRootPart.Position - rootPart.Position).Magnitude or 0
    boxTable.distanceText.Position = Vector2.new(pos.X, pos.Y + height / 2 + 18)
    boxTable.distanceText.Text = ("%.1f studs"):format(dist)
    boxTable.distanceText.Color = Color3.fromRGB(200, 200, 200)
    boxTable.distanceText.Visible = true

    return true
end

local function espLoop(deltaTime)
    for player, boxTable in pairs(boxes) do
        local character = player.Character
        if character and character.Parent then
            local alive = updateBox(boxTable, character, deltaTime)
            if not alive then
                removeBox(boxTable)
                boxes[player] = nil
            end
        else
            removeBox(boxTable)
            boxes[player] = nil
        end
    end
end

local function addPlayer(player)
    if player == LocalPlayer then return end
    if boxes[player] then return end

    local function onCharacterAdded(character)
        if not espEnabled then return end
        if boxes[player] then return end
        boxes[player] = createBox()
    end

    player.CharacterAdded:Connect(onCharacterAdded)

    if player.Character then
        boxes[player] = createBox()
    end
end

local function removePlayer(player)
    if boxes[player] then
        removeBox(boxes[player])
        boxes[player] = nil
    end
end

local espLastTime = tick()

local function toggleESP(state)
    espEnabled = state

    if not espEnabled then
        for player, boxTable in pairs(boxes) do
            removeBox(boxTable)
        end
        boxes = {}
    else
        for _, player in pairs(Players:GetPlayers()) do
            addPlayer(player)
        end
    end
end

-----------------------------------------------------------
--                     AIMBOT FUNCTIONS
-----------------------------------------------------------

local function isEnemy(player)
    if player == LocalPlayer then return false end
    if teamCheck then
        if LocalPlayer.Team and player.Team then
            if LocalPlayer.Team == player.Team then
                return false
            end
        end
    end
    
    local character = player.Character
    if not character then return false end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return false end
    
    return true
end

local function isVisible(targetPosition)
    if not wallCheck then return true end
    
    local character = LocalPlayer.Character
    if not character then return false end
    
    local root = character:FindFirstChild("HumanoidRootPart")
    if not root then return false end
    
    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.FilterDescendantsInstances = {character}
    raycastParams.IgnoreWater = true
    
    local direction = (targetPosition - root.Position).Unit
    local distance = (targetPosition - root.Position).Magnitude
    
    local raycastResult = Workspace:Raycast(root.Position, direction * distance, raycastParams)
    
    if raycastResult then
        local hitPart = raycastResult.Instance
        local hitPlayer = Players:GetPlayerFromCharacter(hitPart.Parent)
        
        if hitPlayer and isEnemy(hitPlayer) then
            return true
        end
        return false
    end
    
    return true
end

local function getClosestEnemy()
    local closestEnemy = nil
    local closestDistance = fovRadius
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    for _, player in pairs(Players:GetPlayers()) do
        if isEnemy(player) then
            local character = player.Character
            if character then
                local targetPart = character:FindFirstChild(aimPart)
                if targetPart then
                    local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
                    
                    if onScreen then
                        local screenPoint = Vector2.new(screenPos.X, screenPos.Y)
                        local distance = (screenPoint - screenCenter).Magnitude
                        
                        if distance <= fovRadius then
                            if isVisible(targetPart.Position) then
                                if distance < closestDistance then
                                    closestDistance = distance
                                    closestEnemy = targetPart
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    
    return closestEnemy
end

local function smoothAim(targetPosition)
    local character = LocalPlayer.Character
    if not character then return end
    
    local root = character:FindFirstChild("HumanoidRootPart")
    if not root then return end
    
    local currentCFrame = Camera.CFrame
    local targetCFrame = CFrame.new(Camera.CFrame.Position, targetPosition)
    
    local delta = targetCFrame - currentCFrame
    local smoothedCFrame = currentCFrame + (delta * smoothness)
    
    Camera.CFrame = smoothedCFrame
end

local function instantAim(targetPosition)
    local character = LocalPlayer.Character
    if not character then return end
    
    local root = character:FindFirstChild("HumanoidRootPart")
    if not root then return end
    
    Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPosition)
end

-- Create FOV Circle
local function createFOVCircle()
    if fovCircle then fovCircle:Remove() end
    
    fovCircle = Drawing.new("Circle")
    fovCircle.Visible = fovCircleEnabled
    fovCircle.Thickness = 2
    fovCircle.Color = circleColor
    fovCircle.Transparency = circleTransparency
    fovCircle.Radius = fovRadius
    fovCircle.Filled = false
    fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
end

local function updateFOVCircle()
    if fovCircle then
        fovCircle.Visible = fovCircleEnabled
        fovCircle.Radius = fovRadius
        fovCircle.Color = circleColor
        fovCircle.Transparency = circleTransparency
        fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    end
end

local function aimbotLoop()
    if not aimbotEnabled then return end
    
    local closestEnemy = getClosestEnemy()
    if closestEnemy then
        if smoothness > 0 then
            smoothAim(closestEnemy.Position)
        else
            instantAim(closestEnemy.Position)
        end
    end
end

local function triggerbotLoop()
    if not triggerbotEnabled then return end
    
    local character = LocalPlayer.Character
    if not character then return end
    
    local tool = character:FindFirstChildOfClass("Tool")
    if not tool then return end
    
    local closestEnemy = getClosestEnemy()
    if closestEnemy then
        mouse1click()
    end
end

-----------------------------------------------------------
--                     UI CREATION
-----------------------------------------------------------

-- AIM Tab
local AimTab = Window:CreateTab("Aim", 4483362458)

local AimSection = AimTab:CreateSection("Aimbot Settings")

local AimbotToggle = AimTab:CreateToggle({
    Name = "Enable Aimbot",
    CurrentValue = false,
    Flag = "AimbotToggle",
    Callback = function(value)
        aimbotEnabled = value
    end,
})

local TriggerbotToggle = AimTab:CreateToggle({
    Name = "Enable Triggerbot",
    CurrentValue = false,
    Flag = "TriggerbotToggle",
    Callback = function(value)
        triggerbotEnabled = value
    end,
})

local TeamCheckToggle = AimTab:CreateToggle({
    Name = "Team Check",
    CurrentValue = true,
    Flag = "TeamCheck",
    Callback = function(value)
        teamCheck = value
    end,
})

local WallCheckToggle = AimTab:CreateToggle({
    Name = "Wall Check",
    CurrentValue = true,
    Flag = "WallCheck",
    Callback = function(value)
        wallCheck = value
    end,
})

local HoldToAimToggle = AimTab:CreateToggle({
    Name = "Hold to Aim",
    CurrentValue = false,
    Flag = "HoldToAim",
    Callback = function(value)
        holdToAim = value
    end,
})

local AimPartDropdown = AimTab:CreateDropdown({
    Name = "Aim Part",
    Options = {"Head", "HumanoidRootPart"},
    CurrentOption = "Head",
    Flag = "AimPart",
    Callback = function(option)
        aimPart = option
    end,
})

local SmoothnessSlider = AimTab:CreateSlider({
    Name = "Smoothness",
    Range = {0, 1},
    Increment = 0.05,
    Suffix = "",
    CurrentValue = 0.15,
    Flag = "Smoothness",
    Callback = function(value)
        smoothness = value
    end,
})

local FOVSection = AimTab:CreateSection("FOV Settings")

local FOVCircleToggle = AimTab:CreateToggle({
    Name = "Show FOV Circle",
    CurrentValue = true,
    Flag = "FOVCircleToggle",
    Callback = function(value)
        fovCircleEnabled = value
        updateFOVCircle()
    end,
})

local FOVRadiusSlider = AimTab:CreateSlider({
    Name = "FOV Radius",
    Range = {50, 500},
    Increment = 10,
    Suffix = "px",
    CurrentValue = 150,
    Flag = "FOVRadius",
    Callback = function(value)
        fovRadius = value
        updateFOVCircle()
    end,
})

local FOVColorPicker = AimTab:CreateColorPicker({
    Name = "FOV Color",
    Color = Color3.fromRGB(255, 255, 255),
    Flag = "FOVColor",
    Callback = function(color)
        circleColor = color
        updateFOVCircle()
    end
})

local FOVTransparencySlider = AimTab:CreateSlider({
    Name = "FOV Transparency",
    Range = {0, 1},
    Increment = 0.05,
    Suffix = "",
    CurrentValue = 0.5,
    Flag = "FOVTransparency",
    Callback = function(value)
        circleTransparency = value
        updateFOVCircle()
    end,
})

local KeybindSection = AimTab:CreateSection("Keybinds")

local AimbotKeybind = AimTab:CreateKeybind({
    Name = "Aimbot Toggle",
    CurrentKeybind = "Q",
    HoldToInteract = false,
    Flag = "AimbotKeybind",
    Callback = function()
        aimbotEnabled = not aimbotEnabled
        AimbotToggle:Set(aimbotEnabled)
    end,
})

local TriggerbotKeybind = AimTab:CreateKeybind({
    Name = "Triggerbot Toggle",
    CurrentKeybind = "T",
    HoldToInteract = false,
    Flag = "TriggerbotKeybind",
    Callback = function()
        triggerbotEnabled = not triggerbotEnabled
        TriggerbotToggle:Set(triggerbotEnabled)
    end,
})

-- ESP Tab
local EspTab = Window:CreateTab("ESP", 4483362458)

local EspSection = EspTab:CreateSection("ESP Settings")

local EspToggle = EspTab:CreateToggle({
    Name = "Enable ESP",
    CurrentValue = false,
    Flag = "EspToggle",
    Callback = function(value)
        toggleESP(value)
    end,
})

local RainbowNameToggle = EspTab:CreateToggle({
    Name = "Rainbow Name",
    CurrentValue = false,
    Flag = "RainbowName",
    Callback = function(value)
        RainbowName = value
    end,
})

local RainbowHealthToggle = EspTab:CreateToggle({
    Name = "Rainbow Health",
    CurrentValue = false,
    Flag = "RainbowHealth",
    Callback = function(value)
        RainbowHealth = value
    end,
})

local RainbowBoxToggle = EspTab:CreateToggle({
    Name = "Rainbow Box",
    CurrentValue = false,
    Flag = "RainbowBox",
    Callback = function(value)
        RainbowBox = value
    end,
})

-- MOVEMENT Tab
local MovementTab = Window:CreateTab("Movement", 4483362458)

local MovementSection = MovementTab:CreateSection("Movement Settings")

local WalkspeedToggle = MovementTab:CreateToggle({
    Name = "WalkSpeed",
    CurrentValue = false,
    Flag = "WalkspeedToggle",
    Callback = function(value)
        walkspeedEnabled = value
        applyWalkspeed()
    end,
})

local WalkspeedSlider = MovementTab:CreateSlider({
    Name = "WalkSpeed Value",
    Range = {16, 200},
    Increment = 5,
    Suffix = "",
    CurrentValue = 50,
    Flag = "WalkspeedValue",
    Callback = function(value)
        currentWalkspeed = value
        if walkspeedEnabled then
            applyWalkspeed()
        end
    end,
})

local JumppowerToggle = MovementTab:CreateToggle({
    Name = "JumpPower",
    CurrentValue = false,
    Flag = "JumppowerToggle",
    Callback = function(value)
        jumppowerEnabled = value
        applyJumppower()
    end,
})

local JumppowerSlider = MovementTab:CreateSlider({
    Name = "JumpPower Value",
    Range = {50, 200},
    Increment = 5,
    Suffix = "",
    CurrentValue = 75,
    Flag = "JumppowerValue",
    Callback = function(value)
        currentJumppower = value
        if jumppowerEnabled then
            applyJumppower()
        end
    end,
})

local InfJumpToggle = MovementTab:CreateToggle({
    Name = "Infinite Jump",
    CurrentValue = false,
    Flag = "InfJumpToggle",
    Callback = function(value)
        toggleInfJump(value)
    end,
})

local NoclipToggle = MovementTab:CreateToggle({
    Name = "Noclip",
    CurrentValue = false,
    Flag = "NoclipToggle",
    Callback = function(value)
        toggleNoclip(value)
    end,
})

local FlyToggle = MovementTab:CreateToggle({
    Name = "Fly",
    CurrentValue = false,
    Flag = "FlyToggle",
    Callback = function(value)
        toggleFly(value)
    end,
})

local FlySpeedSlider = MovementTab:CreateSlider({
    Name = "Fly Speed",
    Range = {10, 150},
    Increment = 5,
    Suffix = "",
    CurrentValue = 50,
    Flag = "FlySpeed",
    Callback = function(value)
        flySpeed = value
    end,
})

-- TOOLS Tab
local ToolsTab = Window:CreateTab("Tools", 4483362458)

local VisualSection = ToolsTab:CreateSection("Visual Tools")

local FullbrightToggle = ToolsTab:CreateToggle({
    Name = "Fullbright",
    CurrentValue = false,
    Flag = "FullbrightToggle",
    Callback = function(value)
        toggleFullbright(value)
    end,
})

local NofogToggle = ToolsTab:CreateToggle({
    Name = "No Fog",
    CurrentValue = false,
    Flag = "NofogToggle",
    Callback = function(value)
        toggleNofog(value)
    end,
})

local BoostFPSToggle = ToolsTab:CreateToggle({
    Name = "Boost FPS",
    CurrentValue = false,
    Flag = "BoostFPSToggle",
    Callback = function(value)
        toggleBoostFPS(value)
    end,
})

local ServerSection = ToolsTab:CreateSection("Server Tools")

local ServerHopButton = ToolsTab:CreateButton({
    Name = "Server Hop",
    Callback = function()
        serverHop()
    end,
})

local RejoinButton = ToolsTab:CreateButton({
    Name = "Rejoin Server",
    Callback = function()
        TeleportService:Teleport(game.PlaceId, LocalPlayer)
    end,
})

-- NEW TAB: External Script
local ExternalTab = Window:CreateTab("External", 4483362458)

local ExternalSection = ExternalTab:CreateSection("External Scripts")

local LoadScriptButton = ExternalTab:CreateButton({
    Name = "Load External Script",
    Callback = function()
        loadstring(game:HttpGet("https://pastefy.app/uHzxKgFZ/raw"))()
    end,
})

local ExternalInfo = ExternalTab:CreateLabel("Click to load external script")

-----------------------------------------------------------
--                     INITIALIZATION
-----------------------------------------------------------

Players.PlayerAdded:Connect(addPlayer)
Players.PlayerRemoving:Connect(removePlayer)

LocalPlayer.CharacterAdded:Connect(function()
    applyWalkspeed()
    applyJumppower()
end)

renderConnection = RunService.RenderStepped:Connect(function()
    if aimbotEnabled then
        aimbotLoop()
    end
    
    if triggerbotEnabled then
        triggerbotLoop()
    end
    
    if espEnabled then
        local now = tick()
        local deltaTime = now - espLastTime
        espLastTime = now
        espLoop(deltaTime)
    end
end)

createFOVCircle()

Camera:GetPropertyChangedSignal("ViewportSize"):Connect(function()
    updateFOVCircle()
end)

local function cleanup()
    if renderConnection then renderConnection:Disconnect() end
    if infJumpConnection then infJumpConnection:Disconnect() end
    if noclipConnection then noclipConnection:Disconnect() end
    if flyConnection then flyConnection:Disconnect() end
    
    if fovCircle then fovCircle:Remove() end
    
    for player, boxTable in pairs(boxes) do
        removeBox(boxTable)
    end
    boxes = {}
end

game:GetService("Players").LocalPlayer.CharacterRemoving:Connect(cleanup)

print("Battle Area | (WaveTerminal) v1.0 COMPLETE Loaded Successfully!")
print("Tabs Available:")
print("- Aim: Aimbot, Triggerbot, FOV Settings")
print("- ESP: ESP System with Rainbow Effects")
print("- Movement: WalkSpeed, JumpPower, Fly, Noclip")
print("- Tools: Fullbright, No Fog, Boost FPS, Server Hop")
print("- External: Load External Scripts")
